<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
  <title>Grid_+001_+002.tif</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@0.7.5/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@0.7.5/dist/leaflet.js"></script>

  <style>
    body { margin:0; padding:0; }
    body, table, tr, td, th, div, h1, h2, input { font-family: "Calibri", "Trebuchet MS", "Ubuntu", Serif; font-size: 11pt; }
    #map { position:absolute; top:0; bottom:0; width:100%; } /* full size */
    .ctl {
      padding: 2px 10px 2px 10px;
      background: white;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      border-radius: 5px;
      text-align: right;
    }
    .title {
      font-size: 18pt;
      font-weight: bold;
    }
    .src {
      font-size: 10pt;
    }
    .tile-info {
      padding: 6px 10px;
      background: white;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      border-radius: 5px;
      font-size: 12pt;
    }

  </style>

</head>
<body>

<div id="map"></div>

<script>
  /* **** Leaflet **** */

  // Base layers
  // 天地图 token，请在 https://console.tianditu.gov.cn/api/key 申请
  var tdtToken = '782cfa7e1b12cd72e0a3a8f09ab54f38';

  //  .. 天地图矢量底图
  var tdtVec = L.tileLayer('http://t{s}.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=' + tdtToken, {
    subdomains: ['0', '1', '2', '3', '4', '5', '6', '7'],
    attribution: '&copy; <a href="http://www.tianditu.gov.cn">天地图</a>',
    maxZoom: 22,
    maxNativeZoom: 18
  });

  //  .. 天地图矢量标注
  var tdtCva = L.tileLayer('http://t{s}.tianditu.gov.cn/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=' + tdtToken, {
    subdomains: ['0', '1', '2', '3', '4', '5', '6', '7'],
    attribution: '&copy; <a href="http://www.tianditu.gov.cn">天地图</a>',
    maxZoom: 22,
    maxNativeZoom: 18
  });

  //  .. 天地图影像底图
  var tdtImg = L.tileLayer('http://t{s}.tianditu.gov.cn/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=' + tdtToken, {
    subdomains: ['0', '1', '2', '3', '4', '5', '6', '7'],
    attribution: '&copy; <a href="http://www.tianditu.gov.cn">天地图</a>',
    maxZoom: 22,
    maxNativeZoom: 18
  });

  //  .. 天地图影像标注
  var tdtCia = L.tileLayer('http://t{s}.tianditu.gov.cn/DataServer?T=cia_w&x={x}&y={y}&l={z}&tk=' + tdtToken, {
    subdomains: ['0', '1', '2', '3', '4', '5', '6', '7'],
    attribution: '&copy; <a href="http://www.tianditu.gov.cn">天地图</a>',
    maxZoom: 22,
    maxNativeZoom: 18
  });

  //  .. 白色背景
  var white = L.tileLayer("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAQMAAABmvDolAAAAA1BMVEX///+nxBvIAAAAH0lEQVQYGe3BAQ0AAADCIPunfg43YAAAAAAAAAAA5wIhAAAB9aK9BAAAAABJRU5ErkJggg==", {maxZoom: 22});

  // Overlay layers (XYZ)
  var lyr = L.tileLayer('./{z}/{x}/{y}.png', {opacity: 0.7, attribution: "", maxZoom: 22});

  // 图层组合
  var tdtVecGroup = L.layerGroup([tdtVec, tdtCva]);
  var tdtImgGroup = L.layerGroup([tdtImg, tdtCia]);

  // Map
  var map = L.map('map', {
    center: [22.652460478569424, 113.67013094785621],
    zoom: 16,
    maxZoom: 22,
    layers: [tdtVecGroup, lyr]
  });

  var basemaps = {"天地图矢量": tdtVecGroup, "天地图影像": tdtImgGroup, "无底图": white}
  var overlaymaps = {"图层": lyr}

  // Title
  var title = L.control();
  title.onAdd = function(map) {
    this._div = L.DomUtil.create('div', 'ctl title');
    this.update();
    return this._div;
  };
  title.update = function(props) {
    this._div.innerHTML = "Grid_+001_+002.tif";
  };
  title.addTo(map);

  // Note
  var src = 'Generated by <a href="https://gdal.org/programs/gdal2tiles.html">GDAL2Tiles</a>, Copyright &copy; 2008 <a href="http://www.klokan.cz/">Klokan Petr Pridal</a>,  <a href="https://gdal.org">GDAL</a> &amp; <a href="https://www.osgeo.org/">OSGeo</a> <a href="https://summerofcode.withgoogle.com/">GSoC</a>';
  var title = L.control({position: 'bottomleft'});
  title.onAdd = function(map) {
    this._div = L.DomUtil.create('div', 'ctl src');
    this.update();
    return this._div;
  };
  title.update = function(props) {
    this._div.innerHTML = src;
  };
  title.addTo(map);


  // Add base layers
  L.control.layers(basemaps, overlaymaps, {collapsed: false}).addTo(map);


  // Calculate tile coordinates from lat/lng (XYZ format)
  function getTileCoords(lat, lng, zoom) {
    var x = Math.floor((lng + 180) / 360 * Math.pow(2, zoom));
    var y = Math.floor((1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom));
    return {x: x, y: y, z: zoom};
  }

  // Show popup on click
  map.on('click', function(e) {
    var zoom = map.getZoom();
    var tile = getTileCoords(e.latlng.lat, e.latlng.lng, zoom);
    L.popup()
      .setLatLng(e.latlng)
      .setContent('Z: ' + tile.z + '<br>X: ' + tile.x + '<br>Y: ' + tile.y)
      .openOn(map);
  });

</script>

</body>
</html>
